(import 'inc/func.inc)
(import 'inc/syscall.inc)

(def-func 'sys/read_line)
	;inputs
	;r0 = buffer address
	;r1 = buffer size
	;r2 = fd
	;outputs
	;r0 = chars read
	;trashes
	;r0-r3, r5

	(vp-cpy-rr r0 r3)
	(vp-cpy-rr r0 r5)
	(vp-add-rr r0 r1)
	loop_while r5, !=, r1
		sys_read_char r2
		(vp-cpy-ri-b r0 r5)
		(vp-inc r5)
	loop_until r0, ==, 10
	(vp-cpy-rr r5 r0)
	(vp-sub-rr r3 r0)
	(vp-ret)

(def-func-end)
