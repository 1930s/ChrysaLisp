(import 'inc/func.inc)
(import 'inc/task.inc)

(def-func 'sys/task_restore)
	;restore next task
	;r15 = control block to restore

	;round robin past any list head
	(ln-get-forward r15 r0)
	(f-bind 'sys_task 'statics r0)
	(vp-cpy-ri r15 r0 tk_statics_current_tcb)

	;restore old stack pointer
	(vp-cpy-ir r15 tk_node_stack r4)

	;pop task state
	(tk-load-state)
	(vp-ret)

(def-func-end)
