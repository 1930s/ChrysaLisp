(import 'inc/func.inc)
(import 'inc/task.inc)

(def-func 'sys/task_suspend)
	;push task state
	(tk-save-state)

	;save stack pointer
	(f-bind 'sys_task 'statics r0)
	(vp-cpy-ir r0 tk_statics_current_tcb r0)
	(vp-cpy-ri r4 r0 tk_node_stack)

	;remove task control block, and flag as suspended
	(vp-cpy-rr r0 r1)
	(ln-remove-node r1 r15)
	(vp-xor-rr r1 r1)
	(vp-cpy-ri r1 r0)

	;restore next task
	(f-jmp 'sys_task 'restore)

(def-func-end)
