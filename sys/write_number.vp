(import 'inc/func.inc)
(import 'inc/syscall.inc)

(def-func 'sys/write_number)
	;inputs
	;r0 = number
	;r1 = fd
	;r2 = base
	;trashes
	;r0, r2-r3, r5

	(vp-cpy-rr r2 r3)	;base
	(vp-cpy-rr r4 r5)	;stack location
	(loop-start)
		(vp-xor-rr r2 r2)
		(vp-div r3 r2 r0)
		(vp-push r2)
	(loop-until '(r0 == 0))
	(loop-start)
		(vp-pop r0)
		(vp-add-cr '0' r0)
		if r0, >, '9'
			(vp-add-cr 'A' - ':' r0)
		endif
		sys_write_char r1, r0
	(loop-until '(r5 == r4))
	(vp-ret)

(def-func-end)
