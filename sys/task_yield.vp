(import 'inc/func.inc)
(import 'inc/task.inc)

(def-func 'sys/task_yield)
	;push task state
	(tk-save-state)

	;save old stack pointer
	(f-bind 'sys_task 'statics r15)
	(vp-cpy-ir r15 tk_statics_current_tcb r15)
	(vp-cpy-ri r4 r15 tk_node_stack)

	;get next task control block
	(ln-get-succ r15 r15)
	(f-jmp 'sys_task 'restore)

(def-func-end)
