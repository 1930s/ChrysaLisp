(import 'inc/func.inc)
(import 'class/class_stream.inc)

(def-func 'class/stream/deinit)
	;inputs
	;r0 = stream object
	;trashes
	;all but r0, r4

	;deref any buffer object
	vp_push r0
	(vp-cpy-ir r0 stream_object r0)
	if r0, !=, 0
		(f-call 'ref 'deref '(r0))
	endif

	;free any buffer
	(vp-cpy-ir r4 r0)
	(f-call 'sys_mem 'free '([r0 + stream_buffer]))
	vp_pop r0

	;parent deinit
	s_jmp stream, deinit, {r0}

(def-func-end)
