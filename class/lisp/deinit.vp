(import 'sys/func.inc)
(import 'class/lisp/class.inc)

(def-method 'lisp 'deinit)
	;inputs
	;r0 = lisp object (ptr)
	;trashes
	;all but r0

	(ptr 'this)

	(push-scope)
	(entry 'lisp 'deinit {this})

	;deinit myself
	(call 'obj 'deref {this->lisp_stdin})
	(call 'obj 'deref {this->lisp_stdout})
	(call 'obj 'deref {this->lisp_stderr})
	(call 'obj 'deref {this->lisp_environment})

	;deinit parent
	(exit 'lisp 'deinit {this})
	(pop-scope)
	(s-jmp 'lisp 'deinit '(r0))

(def-func-end)
